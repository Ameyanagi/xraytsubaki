# TypeScript Bindings for XRayTsubaki

This package provides TypeScript bindings for XRayTsubaki, a high-performance Rust implementation of X-ray absorption spectroscopy (XAS) analysis tools.

## Overview

The TypeScript bindings use [ffi-napi](https://www.npmjs.com/package/ffi-napi) and [ref-napi](https://www.npmjs.com/package/ref-napi) to interface with the compiled Rust library. These bindings enable Node.js applications to leverage the performance benefits of Rust while providing a familiar TypeScript API.

## Project Structure

- `src/` - TypeScript source code
  - `index.ts` - Main entry point
  - `xasspectrum.ts` - XASSpectrum class implementation
  - `xasgroup.ts` - XASGroup class implementation
  - `fitting.ts` - EXAFS fitting functionality
  - `multispectrum.ts` - Multi-spectrum fitting functionality
  - `utils.ts` - Utility functions
  - `ffi/` - Foreign Function Interface definitions
    - `bindings.ts` - Core FFI bindings
    - `types.ts` - Type definitions

- `types/` - TypeScript type definitions
- `test/` - Test files

## Development Approach

The development follows a Test-Driven Development (TDD) approach:

1. Create TypeScript interfaces that match the Rust API
2. Implement test cases based on the expected behavior
3. Implement the TypeScript bindings to pass the tests
4. Validate against test data generated by the Rust library

## Implementation Details

### FFI Bindings

The bindings use `ffi-napi` to load and call functions from the compiled Rust library. The TypeScript interface closely follows the Rust API while providing a more idiomatic TypeScript experience.

### Type Mappings

| Rust Type | TypeScript Type |
|-----------|-----------------|
| `f64` | `number` |
| `Option<f64>` | `number \| null` |
| `ArrayBase<OwnedRepr<f64>, Ix1>` | `Float64Array` |
| `Option<ArrayBase<OwnedRepr<f64>, Ix1>>` | `Float64Array \| null` |
| `String` | `string` |
| `Option<String>` | `string \| null` |
| `Vec<T>` | `Array<T>` |
| Rust Enums | TypeScript string union types or class hierarchies |

### Class Hierarchy

- `XASSpectrum` - Core class for working with XAS spectra
- `XASGroup` - Collection of XAS spectra
- `FittingParameter` - Parameter for EXAFS fitting
- `PathModel` - Path model for EXAFS fitting
- `FittingDataset` - Dataset for EXAFS fitting
- `MultiSpectrumDataset` - Dataset for multi-spectrum fitting

## Usage Example

```typescript
import { XASSpectrum, pre_edge, autobk, xftf } from 'ts-xraytsubaki';

// Create a new spectrum
const spectrum = new XASSpectrum();

// Load data
spectrum.loadFromFile('path/to/data.dat');

// Process the spectrum
spectrum.normalize();
spectrum.calcBackground();
spectrum.fft();

// Access results
const energy = spectrum.energy;
const mu = spectrum.mu;
const k = spectrum.k;
const chi = spectrum.chi;
const r = spectrum.r;
const chir = spectrum.chir;
```

## Building and Testing

```bash
# Install dependencies
npm install

# Build the TypeScript bindings
npm run build

# Run tests
npm test
```

## Requirements

- Node.js 14+
- A compiled version of the XRayTsubaki library

## License

MIT